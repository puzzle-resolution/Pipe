# Pipes

## 思路1

- 构造数据结构，定义每个点

    > ```typescript
    > interface Position {
    >     x: number;
    >     y: number;
    > }
    > interface enum ShapeType = {
    >     ONE: '1';
    >     TWO: '2';
    >     THREE: '3';
    >     FOUR: '4';
    > }
    > interface Pipe {
    >     position: Position;
    >     shape: ShapeType;
    > }
    > ```

- 定义 点的状态结构，代表点的四个方向，当前的状态。 true代表已确定连通该方向；false代表已确定不连通该方向；undefined表示未确定

    > ```typescript
    > interface PipeState {
    >     top?: boolean;
    >     bottom?: boolean;
    >     left?: boolean;
    >     right?: boolean;
    > }
    > ```

- 相邻点的相邻方向的状态应是一致的。e.g. AB左右相邻，则 A.right === B.left

- 步骤

    1. 初始化边界，边界方向状态初始化为 false
    1. 对于方向状态改变的点
        1. 判断点是否完成
        1. 计算其他方向是否能确定
        1. 对于确定的方向，传递该状态到相邻节点，并将相邻节点加入待处理队列
    1. 循环处理队列，直到队列为空
    1. 寻找以下几类可进一步确定状态的节点集合，更新状态
        - 对于任意节点，最多有3种方案
            - 对于某个方案，若形成孤立集合（连通集合对外闭合，且不包含水流起点），则该方案不可用
            - 若仅剩一种未确定方案，其余方案都不可用，则可确定节点状态
        - 形如 12…21 ，可确定为孤立集合
        - 相邻的 11，可确定为孤立集合
        - 对于某个集合，若集合未包含水流起点，且某节点为集合唯一的开放口，则可尝试该节点的剩余方案
            - 若相邻两节点，分别为某两个未包含水流起点集合的唯一开放口，则两节点可确定状态为不链接
        - 对于某个节点方案，若计入包含水流起点，且形成封闭集合，但仍存在未完成节点，则改方案不可行
        - 对于相邻的两个节点，若未直接链接时，已确定属于同一集合，则两节点可确定状态为不链接
    1. 不存在第4步所属情况下，全图未完成时，可选择剩余节点递归遍历，并采用第4步规则做等价解，排除不可行方案
        - 分区逻辑
            - 对于一整块封闭区域，可单独做解
            - 封闭区域判断条件：
        - 节点选择策略
            - 优先选择确定状态节点的相邻位置
        - 尝试节点的某些方案做递归验证，节点选择策略如上

